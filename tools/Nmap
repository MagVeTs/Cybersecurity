Nmap Scripting Engine
https://www.youtube.com/watch?v=M-Uq7YSfZ4I
[hat tip: Jonathan Erez]

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
Host Discovery [from: https://tryhackme.com/room/nmap01 (with some editing and additions)]
------------------------------------------------------------------------------------------

Nmap target specification options:
- list: MACHINE_IP scanme.nmap.org example.com will scan 3 IP addresses.
- range: 10.11.12.15-20 will scan 6 IP addresses: 10.11.12.15, 10.11.12.16,… and 10.11.12.20.
- subnet: MACHINE_IP/30 will scan 4 IP addresses.
You can also provide a file as input for your list of targets: nmap -iL list_of_hosts.txt.

Check the list of hosts that Nmap will scan (helpful for situations where you are planning to scan a subnet and do not want to calculate the IP addresses in that subnet - Nmap will do the math for you and list all the possible IPs in the subnet you gave):
nmap -sL TARGETS.
(this option will give you a detailed list of the hosts that Nmap will scan without scanning them; however, Nmap will attempt a reverse-DNS resolution on all the targets to obtain their names. Names might reveal various information to the pentester. [If you don’t want Nmap to the DNS server, you can add -n.])

Nmap Host Discovery Scan Types (i.e. without port scans) With Example Command
-------------------------------------
ARP Scan:	sudo nmap -PR -sn MACHINE_IP/24
(ARP scans only allowed for root and sudoers; ARP scans only work for machines in your own subnet; there is also a dedicated ARP scan tool called arp-scan [http://www.royhills.co.uk/wiki/index.php/Main_Page]); install on Linux: apt install arp-scan)
ICMP Echo Scan:	sudo nmap -PE -sn MACHINE_IP/24 [may be blocked by firewalls - worth trying all ICMP types in case one isn't blocked]
ICMP Timestamp Scan:	sudo nmap -PP -sn MACHINE_IP/24 [may be blocked by firewalls - worth trying all ICMP types in case one isn't blocked]
ICMP Address Mask Scan:	sudo nmap -PM -sn MACHINE_IP/24 [may be blocked by firewalls - worth trying all ICMP types in case one isn't blocked]
TCP SYN Ping Scan:	sudo nmap -PS22,80,443 -sn MACHINE_IP/30 [will work even for unprivileged users; however, only root/sudoers can avoid completion of 3-way handshake]
TCP ACK Ping Scan:	sudo nmap -PA22,80,443 -sn MACHINE_IP/30 [only available for root/sudoers]
UDP Ping Scan:	sudo nmap -PU53,161,162 -sn MACHINE_IP/30 [if the port is closed this generates an ICMP Type 3, Code 3 (port unreachable response) - then you know the host is up; if no response is received you do not know if the host is down or the host is up but the port is open; therefore, it is important to send the UDP Ping Scan specifically to weird ports that would probably be closed (if you are using it for host discovery purposes)]

Option	- Purpose
-n	      no reverse-DNS lookup
-R	      do reverse-DNS lookup for ALL hosts (including those presently offline)
-sn	      perform host discovery only; do not scan for open ports

masscan is a scanning tool similar to Nmap. However, it is quicker because its packet generating rate is aggressive. Install on Linux: apt install masscan.
Example syntax:
masscan MACHINE_IP/24 -p443
masscan MACHINE_IP/24 -p80,443
masscan MACHINE_IP/24 -p22-25
masscan MACHINE_IP/24 ‐‐top-ports 100 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

Port Scanning - from: https://tryhackme.com/room/nmap02 [with some editing and additions]
-----------------------------------------------------------------------------------------
Six Port States in Nmap
-----------------------
1) Open: indicates that a service is listening on the specified port.
2) Closed: indicates that no service is listening on the specified port, although the port is accessible. By accessible, we mean that it is reachable and is not blocked by a firewall or other security appliances/programs.
3) Filtered: means that Nmap cannot determine if the port is open or closed because the port is not accessible. This state is usually due to a firewall preventing Nmap from reaching that port. Nmap’s packets may be blocked from reaching the port; alternatively, the responses are blocked from reaching Nmap’s host.
4) Unfiltered: means that Nmap cannot determine if the port is open or closed, although the port is accessible. This state is encountered when using an ACK scan -sA.
5) Open|Filtered: This means that Nmap cannot determine whether the port is open or filtered.
6) Closed|Filtered: This means that Nmap cannot decide whether a port is closed or filtered.


Port Scan Type  |	Example Command
TCP Connect Scan	nmap -sT <MACHINE_IP>
[available even for unprivileged users; completes 3-way handshake before sending RST packet]
TCP SYN Scan	    sudo nmap -sS <MACHINE_IP>
[available only for privileged users (root/sudoers); default Nmap scan; does not complete 3-way handshake; instead, sends RST immediately after receiving ACK reply to its SYN packet; by not completing 3-way handshake this scan may avoid getting logged by target]
UDP Scan	        sudo nmap -sU <MACHINE_IP>
[since UDP is connectionless protocol, Nmap knows port is closed if it receives IMCP type 3 (destination unreachable/code 3 (port unreachable) message; no message means port open (or perhaps port is being filtered by a firewall)]


Option        |         Purpose
-p-	                    all ports
-p1-1023                scan ports 1 to 1023
-F	                    100 most common ports
--top-ports 10          will check the ten most common ports.
-r	                    scan ports in consecutive order
-T<0-5>	                -T0 being the slowest and T5 the fastest
--max-rate 50	          rate <= 50 packets/sec
--min-rate 15	          rate >= 15 packets/sec
--min-parallelism 100	  at least 100 probes in parallel

Scan Rates and Stealthiness
---------------------------
"You can control the scan timing using -T<0-5>. -T0 is the slowest (paranoid), while -T5 is the fastest. According to Nmap manual page, there are six templates:
paranoid (0)
sneaky (1)
polite (2)
normal (3)
aggressive (4)
insane (5)
To avoid IDS alerts, you might consider -T0 or -T1. For instance, -T0 scans one port at a time and waits 5 minutes between sending each probe, so you can guess how long scanning one target would take to finish. If you don’t specify any timing, Nmap uses normal -T3. Note that -T5 is the most aggressive in terms of speed; however, this can affect the accuracy of the scan results due to the increased likelihood of packet loss. Note that -T4 is often used during CTFs and when learning to scan on practice targets, whereas -T1 is often used during real engagements where stealth is more important."

