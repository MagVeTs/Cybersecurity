Post Access Internal Enumeration (getting the Lay of the Land)
--------------------------------------------------------------
[from: https://tryhackme.com/room/thelayoftheland]
Windows Environments
--------------------

Network Enumeration:

PowerShell > netstat -na
output shows open TCP and UDP ports

PowerShell > arp -a
output shows IP addresses in the network and their corresponding "physical" MAC addresses

PowerShell > systeminfo | findstr Domain
output shows if device is part of Active Directory domain

PowerShell > Get-ADUser  -Filter *
output shows all active directory user accounts

PowerShell > wmic /namespace:\\root\securitycenter2 path antivirusproduct
or
PowerShell > Get-CimInstance -Namespace root/SecurityCenter2 -ClassName AntivirusProduct
output shows installed AV software

PowerShell > Get-Service WinDefend
output is service state of Windows Defender

PowerShell > Get-MpComputerStatus | select RealTimeProtectionEnabled
output is whether Windows Defender is enabled

PowerShell > Get-NetFirewallProfile | Format-Table Name, Enabled
output is whether firewall is enabled

PowerShell > Get-NetFirewallRule | select DisplayName, Enabled, Description
output is firewall rules

PowerShell > Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False
command disables firewall (need admin privileges to run it)

PowerShell > Test-NetConnection -ComputerName 127.0.0.1 -Port 80
output will confirm if inbound port 80 connection is open and allowed to pass firewall
[note: -ComputerName can also check remote targets in the network if their IP is given]
[note: also see TcpClient cmdlet]

PowerShell > Get-EventLog -List
output is available event logs on the local device
also see: https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1

PowerShell > Get-Process | Where-Object { $_.ProcessName -eq "Sysmon" }
or
PowerShell > Get-CimInstance win32_service -Filter "Description = 'System Monitor service'"
or
PowerShell > reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Sysmon/Operational
output is whether Sysmon is installed on device

PowerShell > findstr /si '<ProcessCreate onmatch="exclude">' C:\tools\*
output is location of Sysmon file 
also see: https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon and https://tryhackme.com/room/sysmon

also see:
https://github.com/PwnDexter/Invoke-EDRChecker
https://github.com/PwnDexter/SharpEDRChecker
[enumerates AV/EDR present on device]

PowerShell > wmic product get name,version
output is all applications installed on system (and their versions)

PowerShell > Get-ChildItem -Hidden -Path <particular path, e.g. C:\Users\ralph\Desktop\>
output is hidden directories


